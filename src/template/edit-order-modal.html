<div class="modal fade" id="editOrderModal" tabindex="-1" aria-labelledby="editOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="editOrderModalLabel">
                    <i class="fas fa-edit me-2"></i>ویرایش سفارش <span id="edit-form-number" class="badge bg-light text-primary ms-2"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="بستن"></button>
            </div>
            <form id="editOrderForm" method="POST">
                <div class="modal-body p-0">
                    <!-- Progress Bar -->
                    <div class="progress rounded-0" style="height: 4px;">
                        <div class="progress-bar" role="progressbar" style="width: 0%" id="editFormProgress"></div>
                    </div>

                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs nav-fill bg-light px-3 pt-3" id="editOrderFormTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="edit-basic-tab" data-bs-toggle="tab" data-bs-target="#edit-basic" type="button" role="tab">
                                <i class="fas fa-info-circle me-2"></i>اطلاعات پایه
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="edit-dimensions-tab" data-bs-toggle="tab" data-bs-target="#edit-dimensions" type="button" role="tab">
                                <i class="fas fa-ruler-combined me-2"></i>ابعاد و مشخصات
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="edit-print-tab" data-bs-toggle="tab" data-bs-target="#edit-print" type="button" role="tab">
                                <i class="fas fa-print me-2"></i>خدمات 
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="edit-dates-tab" data-bs-toggle="tab" data-bs-target="#edit-dates" type="button" role="tab">
                                <i class="fas fa-calendar-alt me-2"></i>تاریخ‌ها و وضعیت
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="edit-notes-tab" data-bs-toggle="tab" data-bs-target="#edit-notes" type="button" role="tab">
                                <i class="fas fa-sticky-note me-2"></i>توضیحات
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="edit-images-tab" data-bs-toggle="tab" data-bs-target="#edit-images" type="button" role="tab">
                                <i class="fas fa-images me-2"></i>تصاویر
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content p-4" id="editOrderFormTabContent">
                        <!-- Basic Info Tab -->
                        <div class="tab-pane fade show active" id="edit-basic" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="number" class="form-control" id="edit_form_number" name="form_number" required>
                                        <label for="edit_form_number">شماره فرم <span class="text-danger">*</span></label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="edit_customer_name" name="customer_name" required>
                                        <label for="edit_customer_name">نام مشتری <span class="text-danger">*</span></label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="edit_sketch_name" name="sketch_name" >
                                        <label for="edit_sketch_name">نام طرح <span class="text-danger">*</span></label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                </div>
                            </div>
                        </div>

                        <!-- Dimensions & Fabric Tab -->
                        <div class="tab-pane fade" id="edit-dimensions" role="tabpanel">
                            <div class="row g-4">

                                <!-- Dimensions -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3"> و مشخصاتابعاد</h6>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <select class="form-control" id="edit_fabric_density" name="fabric_density">
                                                <label for="fabric_density">تراکم</label>
                                                    <option value="40">40</option>
                                                    <option value="50">50</option>
                                                    <option value="60">60</option>
                                                    <option value="70">70</option>
                                                    <option value="80">80</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <select step="0.01" class="form-control" id="edit_width" name="width">
                                                <label for="width">عرض</label>
                                                <option value="1.1">1.1</option>
                                                <option value="1.25">1.25</option>
                                                <option value="1.32">1.32</option>
                                                <option value="1.42">1.42</option>
                                                <option value="1.53">1.53</option>
                                                <option value="1.63">1.63</option>
                                                <option value="1.80">1.80</option>
                                                <option value="2">2</option>
                                                <option value="2.2">2.2</option>
                                                <option value="2.5">2.5</option>
                                                <option value="2.85">2.85</option>
                                                <option value="3.3">3.3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="10">10</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <select step="0.01" class="form-control" id="edit_height" name="height">
                                                <label for="height">طول</label>
                                                <option value="3.5">3.5</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <input type="number" class="form-control form-control-sm cut-field " id="edit_fabric_cut" name="fabric_cut" readonly>
                                                <label for="edit_fabric_cut">برش پارچه</label>
                                            </div>
                                         </div>

                                    </div>
                                </div>

                                <!-- Values Table -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">رنگ بندی </h6>
                                    <div class="table-responsive values_table">
                                        <table class="table table-bordered table-sm text-center align-middle">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>نخ اول</th><th>نخ دوم</th><th>نخ سوم</th><th>نخ جهارم</th><th>نخ پنجم</th><th>نخ ششم</th><th>نخ هفتم</th><th>نخ هشتم</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="color-wrapper">
                                                            <input type="text" class="form-control form-control-sm text-center color-input"  name="edit-values[]">
                                                            <div class="suggestions"></div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Files Table -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">فایل‌ها</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-sm align-middle">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>ردیف</th>
                                                    <th>نام فایل</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <input type="text" class="form-control form-control-sm" name="edit-file_display_names[]">
                                                        <input type="hidden" name="existing_file_ids[]">
                                                        <span class="existing-file-info"></span>
                                                    </td>
                                                    <td><input type="text" class="form-control form-control-sm" name="edit-file_names[]" placeholder="نام فایل"></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="text" class="form-control form-control-sm" name="edit-file_display_names[]">
                                                        <input type="hidden" name="existing_file_ids[]">
                                                        <span class="existing-file-info"></span>
                                                    </td>
                                                    <td><input type="text" class="form-control form-control-sm" name="edit-file_names[]" placeholder="نام فایل"></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="text" class="form-control form-control-sm" name="edit-file_display_names[]">
                                                        <input type="hidden" name="existing_file_ids[]">
                                                        <span class="existing-file-info"></span>
                                                    </td>
                                                    <td><input type="text" class="form-control form-control-sm" name="edit-file_names[]" placeholder="نام فایل"></td>
                                                </tr>
                                                <tr>
                                                    <td>
                                                        <input type="text" class="form-control form-control-sm" name="edit-file_display_names[]">
                                                        <input type="hidden" name="existing_file_ids[]">
                                                        <span class="existing-file-info"></span>
                                                    </td>
                                                    <td><input type="text" class="form-control form-control-sm" name="edit-file_names[]" placeholder="نام فایل"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addFileRowBtn">
                                        <i class="fas fa-plus"></i> افزودن فایل
                                    </button>

                                    <div id="edit-order-files-container"></div>
                                    <!-- Fabric Details -->
                                    <div class="col-12">
                                        <h6 class="border-bottom pb-2 mb-3">جزئیات پارچه</h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="form-floating">
                                                    <input type="number" class="form-control" id="edit_quantity" name="quantity">
                                                    <label for="edit_quantity">تعداد</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-floating">
                                                    <input type="number" step="0.01" class="form-control" id="edit_total_length_meters" name="total_length_meters">
                                                    <label for="edit_total_length_meters">متر</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- Print & Finishing Tab -->
                        <div class="tab-pane fade" id="edit-print" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="edit_label_type" name="label_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="نرم">نرم</option>
                                            <option value="متوسط">متوسط</option>
                                            <option value="خشک">خشک</option>
                                            <option value="بدون آهار">بدون آهار</option>
                                        </select>
                                        <label for="label_type">نوع آهار</label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="edit_cut_type" name="cut_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="تاازبغل"> تاازبغل</option>
                                            <option value="تا از وسط">تا از وسط</option>
                                            <option value=" دانه">دانه‌ای</option>
                                            <option value="لیزر"> لیزر</option>
                                            <option value="برش یک طرف زیاد">برش یک طرف زیاد</option>
                                        </select>
                                        <label for="cut_type">نوع برش</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <div class="dropdown w-100">
                                            <button class="btn btn-light border form-select dropdown-toggle w-100 text-start"
                                                    type="button"
                                                    id="editLaminationDropdown"
                                                    data-bs-toggle="dropdown"
                                                    aria-expanded="false">
                                                انتخاب کنید...
                                            </button>
                                            <ul class="dropdown-menu w-100" aria-labelledby="editLaminationDropdown">
                                                <li><a class="dropdown-item" href="#" data-value="براق">براق</a></li>
                                                <li class="dropdown-submenu dropend">
                                                    <a class="dropdown-item dropdown-toggle" href="#">برجسته و براق</a>
                                                    <ul class="dropdown-menu">
                                                        <li><a class="dropdown-item" href="#" data-value="قالب جدید">قالب جدید</a></li>
                                                        <li><a class="dropdown-item" href="#" data-value="قالب تکراری">قالب تکراری</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                            <input type="hidden" id="edit_lamination_type" name="lamination_type">
                                        </div>
                                        <label for="edit_lamination_type">نوع پرس</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="edit_fusing_type" name="fusing_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="چسب دوطرفه">چسب دوطرفه</option>
                                            <option value="چسب حرارتی ">چسب حرارتی</option>
                                        </select>
                                        <label for="fusing_type">چسب</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dates & Status Tab -->
                        <div class="tab-pane fade" id="edit-dates" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="edit_status" name="status">
                                            <option value="Pending">سفارش</option>
                                            <option value="Design">طراحی</option>
                                            <option value="In Progress">در حال تولید</option>
                                            <option value="Completed">تکمیل شده</option>
                                        </select>
                                        <label for="edit_status">وضعیت</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="edit_created_at" name="created_at" data-jdp>
                                        <label for="edit_created_at">تاریخ ثبت</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="edit_delivery_date" name="delivery_date" data-jdp>
                                        <label for="edit_delivery_date">تاریخ تحویل</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="edit_exit_from_office_date" name="exit_from_office_date" data-jdp>
                                        <label for="edit_exit_from_office_date">تاریخ خروج از دفتر</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="edit_exit_from_factory_date" name="exit_from_factory_date" data-jdp>
                                        <label for="edit_exit_from_factory_date">تاریخ خروج از کارخانه</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes Tab -->
                        <div class="tab-pane fade" id="edit-notes" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="edit_design_specification" name="design_specification" style="height: 100px"></textarea>
                                        <label for="edit_design_specification">مشخصات طراحی</label>
                                    </div>
                                </div>
                                                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="edit_customer_note_to_office" name="customer_note_to_office" style="height: 100px"></textarea>
                                        <label for="edit_customer_note_to_office">توضیحات مشتری به دفتر</label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="edit_office_notes" name="office_notes" style="height: 100px"></textarea>
                                        <label for="edit_office_notes">توضیحات دفتر</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="edit_factory_notes" name="factory_notes" style="height: 100px"></textarea>
                                        <label for="edit_factory_notes">توضیحات کارخانه</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Images Tab -->
                        <div class="tab-pane fade" id="edit-images" role="tabpanel">
                            <div class="row g-4">
                                <!-- Upload Section -->
                                <div class="col-12 mb-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title mb-3">بارگذاری تصاویر جدید</h6>
                                            <div class="mb-3">
                                                <label for="editOrderImages" class="form-label">انتخاب تصاویر</label>
                                                <input type="file" class="form-control" id="editOrderImages" name="images" multiple accept="image/*">
                                                <div class="form-text">حداکثر حجم فایل: ۱۰ مگابایت. فرمت‌های مجاز: PNG, JPG, JPEG, GIF, WEBP</div>
                                            </div>
                                            <div id="editImagePreviewContainer" class="row g-2 mt-3">
                                                <!-- Image previews will be added here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Images Display Section -->
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title mb-3">تصاویر سفارش</h6>
                                            <div id="edit-no-images-message" class="alert alert-info" style="display: none;">
                                                <i class="fas fa-info-circle me-2"></i>هیچ تصویری برای این سفارش بارگذاری نشده است.
                                            </div>
                                            <div id="edit-order-images-container" class="row g-3">
                                                <!-- Images will be dynamically inserted here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="d-flex justify-content-between w-100">
                        <div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i>انصراف
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-outline-primary me-2" id="editPrevTab">
                                <i class="fas fa-arrow-right me-2"></i>قبلی
                            </button>
                            <button type="button" class="btn btn-outline-primary me-2" id="editNextTab">
                                بعدی<i class="fas fa-arrow-left ms-2"></i>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>ذخیره تغییرات
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab navigation functionality for edit modal
    const nextTabBtn = document.getElementById('editNextTab');
    const prevTabBtn = document.getElementById('editPrevTab');
    const tabButtons = document.querySelectorAll('#editOrderFormTabs .nav-link');
    const tabPanes = document.querySelectorAll('#editOrderFormTabContent .tab-pane');
    const progressBar = document.getElementById('editFormProgress');

    let currentTabIndex = 0;

    // Function to update progress bar
    function updateProgress() {
        const progress = ((currentTabIndex + 1) / tabButtons.length) * 100;
        progressBar.style.width = progress + '%';
    }

    // Function to show specific tab
    function showTab(index) {
        // Hide all tabs
        tabPanes.forEach(pane => {
            pane.classList.remove('show', 'active');
        });
        tabButtons.forEach(btn => {
            btn.classList.remove('active');
        });

        // Show specific tab
        if (index >= 0 && index < tabButtons.length) {
            tabPanes[index].classList.add('show', 'active');
            tabButtons[index].classList.add('active');
            currentTabIndex = index;
            updateProgress();
        }

        // Update button states
        prevTabBtn.disabled = currentTabIndex === 0;
        nextTabBtn.disabled = currentTabIndex === tabButtons.length - 1;
    }

    // Next button click handler
    if (nextTabBtn) {
        nextTabBtn.addEventListener('click', function() {
            if (currentTabIndex < tabButtons.length - 1) {
                showTab(currentTabIndex + 1);
            }
        });
    }

    // Previous button click handler
    if (prevTabBtn) {
        prevTabBtn.addEventListener('click', function() {
            if (currentTabIndex > 0) {
                showTab(currentTabIndex - 1);
            }
        });
    }

    // Tab button click handlers
    tabButtons.forEach((button, index) => {
        button.addEventListener('click', function() {
            showTab(index);
        });
    });

    // Initialize progress bar
    updateProgress();
});
function calculateCut() {
        const height = parseFloat(document.getElementById('edit_height').value) || 0;
        const cut = height + 1.6;
        document.getElementById('edit_fabric_cut').value = cut.toFixed(2);
    }
    const heightInput = document.getElementById('edit_height');
    if (heightInput) {
        heightInput.addEventListener('change', calculateCut);
        calculateCut();
}

</script>
