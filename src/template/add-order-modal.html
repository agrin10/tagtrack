<!-- Create Order Modal -->
<div class="modal fade" id="createOrderModal" tabindex="-1" aria-labelledby="createOrderModalLabel" aria-hidden="true" dir="rtl">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="createOrderModalLabel">
                    <i class="fas fa-plus-circle me-2"></i>ایجاد سفارش جدید
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="بستن"></button>
            </div>
            <form method="POST" action="{{ url_for('order.create_order') }}" id="createOrderForm" enctype="multipart/form-data">
                <div class="modal-body p-0">
                    <!-- Progress Bar -->
                    <div class="progress rounded-0" style="height: 4px;">
                        <div class="progress-bar" role="progressbar" style="width: 0%" id="formProgress"></div>
                    </div>

                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs nav-fill bg-light px-3 pt-3" id="orderFormTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                                <i class="fas fa-info-circle me-2"></i>اطلاعات پایه
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="dimensions-tab" data-bs-toggle="tab" data-bs-target="#dimensions" type="button" role="tab">
                                <i class="fas fa-ruler-combined me-2"></i>مشخصات و پارچه
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="print-tab" data-bs-toggle="tab" data-bs-target="#print" type="button" role="tab">
                                <i class="fas fa-print me-2"></i>خدمات
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="dates-tab" data-bs-toggle="tab" data-bs-target="#dates" type="button" role="tab">
                                <i class="fas fa-calendar-alt me-2"></i>تاریخ‌ها و وضعیت
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab">
                                <i class="fas fa-sticky-note me-2"></i>توضیحات
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="images-tab" data-bs-toggle="tab" data-bs-target="#images" type="button" role="tab">
                                <i class="fas fa-images me-2"></i>تصاویر
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content p-4" id="orderFormTabContent">
                        <!-- Basic Info Tab -->
                        <div class="tab-pane fade show active" id="basic" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-3">
                                    <div class="form-floating">
                                        <!-- Preview only: disabled, not submitted -->
                                        <input type="number" class="form-control" id="form_number" disabled>
                                        <label for="form_number">شماره فرم (پیش‌نمایش)</label>
                                    </div>
                                    </div>

                                <!-- Optional: let the user request a starting number -->
                                <div class="col-md-3">
                                    <div class="form-floating">
                                        <!-- This WILL be submitted if filled -->
                                        <input type="number" min="1" class="form-control" id="start_form_number" name="start_form_number" placeholder="اختیاری: شروع از شماره ...">
                                        <label for="start_form_number">شروع شماره (اختیاری)</label>
                                </div>
                                <small id="startFormNote" class="form-text text-muted">
                                    اگر این شماره بزرگ‌تر از بیشینه فعلی باشد، دنباله از آن شروع خواهد شد.
                                </small>
                                <div id="startFormWarning" class="text-danger small mt-1" style="display:none;"></div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-floating">
                                        <input type="datetime-local" class="form-control" id="created_at" name="created_at" disabled>
                                        <label for="created_at">تاریخ ثبت</label>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="sketch_name" name="sketch_name" required>
                                        <label for="sketch_name">نام طرح <span class="text-danger">*</span></label>
                                    </div>
                                </div>
                                <div class="col-md-3 position-relative">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="customer_name" name="customer_name" autocomplete="off" required>
                                        <label for="customer_name">نام مشتری <span class="text-danger">*</span></label>
                                    </div>
                                    <ul id="name_suggestions"
                                        class="list-group position-absolute w-100"
                                        style="z-index:1000; top:100%; display:none; max-height:150px; overflow-y:auto;">
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Dimensions & Fabric Tab -->
                        <div class="tab-pane fade" id="dimensions" role="tabpanel">
                            <div class="row g-4">


                                <!-- Dimensions -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">ابعاد</h6>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <select class="form-control" id="fabric_density" name="fabric_density">
                                                    <option value="40">40</option>
                                                    <option value="50">50</option>
                                                    <option value="60">60</option>
                                                    <option value="70">70</option>
                                                    <option value="80">80</option>
                                                </select>
                                                <label for="fabric_density">تراکم</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <select step="0.01" class="form-control" id="width" name="width">
                                                    <option value="1.1">1.1</option>
                                                    <option value="1.25">1.25</option>
                                                <option value="1.32">1.32</option>
                                                <option value="1.42">1.42</option>
                                                <option value="1.53">1.53</option>
                                                <option value="1.63">1.63</option>
                                                <option value="1.80">1.80</option>
                                                <option value="2">2</option>
                                                <option value="2.2">2.2</option>
                                                <option value="2.5">2.5</option>
                                                <option value="2.85">2.85</option>
                                                <option value="3.3">3.3</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                <option value="10">10</option>
                                            </select>
                                                <label for="width">عرض</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <select step="0.01" class="form-control" id="height" name="height">
                                                <option value="3.5">3.5</option>
                                                <option value="4">4</option>
                                                <option value="5">5</option>
                                                <option value="6">6</option>
                                                <option value="7">7</option>
                                                <option value="8">8</option>
                                                </select>
                                                    <label for="height">طول</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <input type="number" class="form-control form-control-sm cut-field " id="fabric_cut" name="fabric_cut" id="fabric_cut" readonly>
                                                <label for="fabric_cut">برش</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Values Table -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">رنگ بندی </h6>
                                    <div class="table-responsive values_table">
                                        <table class="table table-bordered table-sm text-center align-middle">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>نخ اول</th><th>نخ دوم</th><th>نخ سوم</th><th>نخ جهارم</th><th>نخ پنجم</th><th>نخ ششم</th><th>نخ هفتم</th><th>نخ هشتم</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ اول">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ دوم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ سوم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ چهارم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ پنجم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ ششم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ هفتم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                    <td>
                                                    <div class="color-wrapper">
                                                        <input type="text" class="form-control form-control-sm text-center color-input"  name="values[]" placeholder="نخ هشتم">
                                                        <div class="suggestions"></div>
                                                    </div>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Files Table -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">فایل‌ها</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-sm align-middle" id="filesTable">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>ردیف</th>
                                                    <th>نام فایل</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filesTableBody">
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addFileRowBtn">
                                        <i class="fas fa-plus"></i> افزودن فایل
                                    </button>
                                </div>
                                <!-- Fabric Details -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">جزئیات پارچه</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="number" class="form-control" id="quantity" name="quantity">
                                                <label for="quantity">تعداد</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="number" step="0.01" class="form-control" id="total_length_meters" name="total_length_meters">
                                                <label for="total_length_meters">متر</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Print & Finishing Tab -->
                        <div class="tab-pane fade" id="print" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="label_type" name="label_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="نرم">نرم</option>
                                            <option value="متوسط">متوسط</option>
                                            <option value="خشک">خشک</option>
                                            <option value="بدون آهار">بدون آهار</option>
                                        </select>
                                        <label for="label_type">نوع آهار</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="cut_type" name="cut_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="تاازبغل"> تاازبغل</option>
                                            <option value="تا از وسط">تا از وسط</option>
                                            <option value=" دانه">دانه‌ای</option>
                                            <option value="لیزر"> لیزر</option>
                                            <option value="برش یک طرف زیاد">برش یک طرف زیاد</option>
                                        </select>
                                        <label for="cut_type">نوع برش</label>
                                    </div>
                                </div>


                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <div class="dropdown w-100">
                                            <button class="btn btn-light border form-select dropdown-toggle w-100 text-start" type="button" id="laminationDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                انتخاب کنید...
                                            </button>
                                            <ul class="dropdown-menu w-100" aria-labelledby="laminationDropdown">
                                                <li><a class="dropdown-item" href="#" data-value="براق">براق</a></li>
                                                <li class="dropdown-submenu dropend">
                                                    <a class="dropdown-item dropdown-toggle" href="#">برجسته و براق</a>
                                                    <ul class="dropdown-menu">
                                                        <li><a class="dropdown-item" href="#" data-value="قالب جدید">قالب جدید</a></li>
                                                        <li><a class="dropdown-item" href="#" data-value="قالب تکراری">قالب تکراری</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                            <input type="hidden" id="lamination_type" name="lamination_type">
                                        </div>
                                        <label for="lamination_type">نوع پرس</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="fusing_type" name="fusing_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="چسب دوطرفه">چسب دوطرفه</option>
                                            <option value="چسب حرارتی ">چسب حرارتی</option>
                                        </select>
                                        <label for="fusing_type">چسب</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dates & Status Tab -->
                        <div class="tab-pane fade" id="dates" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="status" name="status">
                                            <option value="Pending">سفارش</option>
                                            <option value="Design">طراحی</option>
                                            <option value="In Progress">در حال تولید</option>
                                            <option value="Completed">تکمیل شده</option>
                                        </select>   
                                        <label for="status">وضعیت</label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="delivery_date" name="delivery_date" data-jdp>
                                        <label for="delivery_date">تاریخ تحویل</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="exit_from_office_date" name="exit_from_office_date" data-jdp>
                                        <label for="exit_from_office_date">تاریخ خروج از دفتر</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="exit_from_factory_date" name="exit_from_factory_date" data-jdp>
                                        <label for="exit_from_factory_date">تاریخ خروج از کارخانه</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes Tab -->
                        <div class="tab-pane fade" id="notes" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="design_specification" name="design_specification" style="height: 100px"></textarea>
                                        <label for="design_specification">مشخصات طراحی</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="customer_note_to_office" name="customer_note_to_office" style="height: 100px"></textarea>
                                        <label for="customer_note_to_office">توضیحات مشتری به دفتر</label>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="office_notes" name="office_notes" style="height: 100px"></textarea>
                                        <label for="office_notes">توضیحات دفتر</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="factory_notes" name="factory_notes" style="height: 100px"></textarea>
                                        <label for="factory_notes">توضیحات کارخانه</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Images Tab -->
                        <div class="tab-pane fade" id="images" role="tabpanel">
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title mb-3">بارگذاری تصاویر</h6>
                                            <div class="mb-3">
                                                <label for="orderImages" class="form-label">انتخاب تصاویر</label>
                                                <input type="file" class="form-control" id="orderImages" name="images" multiple accept="image/*">
                                                <div class="form-text">حداکثر حجم فایل: ۱۰ مگابایت. فرمت‌های مجاز: PNG, JPG, JPEG, GIF, WEBP</div>
                                            </div>
                                            <div id="imagePreviewContainer" class="row g-2 mt-3">
                                                <!-- Image previews will be added here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="d-flex justify-content-between w-100">
                        <div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i>انصراف
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-outline-primary me-2" id="prevTab">
                                <i class="fas fa-arrow-right me-2"></i>قبلی
                            </button>
                            <button type="button" class="btn btn-outline-primary me-2" id="nextTab">
                                بعدی<i class="fas fa-arrow-left ms-2"></i>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>ایجاد سفارش
                            </button>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- End of Create Order Modal -->

{% block scripts %}

{% endblock scripts%}