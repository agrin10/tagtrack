<!-- Create Order Modal -->
<div class="modal fade" id="createOrderModal" tabindex="-1" aria-labelledby="createOrderModalLabel" aria-hidden="true" dir="rtl">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="createOrderModalLabel">
                    <i class="fas fa-plus-circle me-2"></i>ایجاد سفارش جدید
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="بستن"></button>
            </div>
            <form method="POST" action="{{ url_for('order.create_order') }}" id="createOrderForm" enctype="multipart/form-data">
                <div class="modal-body p-0">
                    <!-- Progress Bar -->
                    <div class="progress rounded-0" style="height: 4px;">
                        <div class="progress-bar" role="progressbar" style="width: 0%" id="formProgress"></div>
                    </div>

                    <!-- Tab Navigation -->
                    <ul class="nav nav-tabs nav-fill bg-light px-3 pt-3" id="orderFormTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic" type="button" role="tab">
                                <i class="fas fa-info-circle me-2"></i>اطلاعات پایه
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="dimensions-tab" data-bs-toggle="tab" data-bs-target="#dimensions" type="button" role="tab">
                                <i class="fas fa-ruler-combined me-2"></i>ابعاد و پارچه
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="print-tab" data-bs-toggle="tab" data-bs-target="#print" type="button" role="tab">
                                <i class="fas fa-print me-2"></i>چاپ و تکمیل
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="dates-tab" data-bs-toggle="tab" data-bs-target="#dates" type="button" role="tab">
                                <i class="fas fa-calendar-alt me-2"></i>تاریخ‌ها و وضعیت
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button" role="tab">
                                <i class="fas fa-sticky-note me-2"></i>یادداشت‌ها
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="images-tab" data-bs-toggle="tab" data-bs-target="#images" type="button" role="tab">
                                <i class="fas fa-images me-2"></i>تصاویر
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content p-4" id="orderFormTabContent">
                        <!-- Basic Info Tab -->
                        <div class="tab-pane fade show active" id="basic" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="sketch_name" name="sketch_name" required>
                                        <label for="sketch_name">نام طرح <span class="text-danger">*</span></label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-floating">
                                        <input type="text" class="form-control" id="customer_name" name="customer_name" required>
                                        <label for="customer_name">نام مشتری <span class="text-danger">*</span></label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dimensions & Fabric Tab -->
                        <div class="tab-pane fade" id="dimensions" role="tabpanel">
                            <div class="row g-4">
                                <!-- Fabric Details -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">جزئیات پارچه</h6>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="number" class="form-control" id="fabric_density" name="fabric_density">
                                                <label for="fabric_density">اهار پارچه</label>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-floating">
                                                <input type="number" class="form-control" id="fabric_cut" name="fabric_cut">
                                                <label for="fabric_cut">برش پارچه</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Dimensions -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">ابعاد</h6>
                                    <div class="row g-3">
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <input type="number" step="0.01" class="form-control" id="width" name="width">
                                                <label for="width">عرض (سانتی‌متر)</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <input type="number" step="0.01" class="form-control" id="height" name="height">
                                                <label for="height">ارتفاع (سانتی‌متر)</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <input type="number" class="form-control" id="quantity" name="quantity">
                                                <label for="quantity">تعداد</label>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-floating">
                                                <input type="number" step="0.01" class="form-control" id="total_length_meters" name="total_length_meters">
                                                <label for="total_length_meters">طول کل (متر)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Values Table -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">مقادیر</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-sm text-center align-middle">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>۱</th><th>۲</th><th>۳</th><th>۴</th><th>۵</th><th>۶</th><th>۷</th><th>۸</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                    <td><input type="text" class="form-control form-control-sm text-center" name="values[]" placeholder="مقدار"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Files Table -->
                                <div class="col-12">
                                    <h6 class="border-bottom pb-2 mb-3">فایل‌ها</h6>
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-sm align-middle" id="filesTable">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>ردیف</th>
                                                    <th>نام فایل</th>
                                                </tr>
                                            </thead>
                                            <tbody id="filesTableBody">
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                                <tr>
                                                    <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                                                    <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addFileRowBtn">
                                        <i class="fas fa-plus"></i> افزودن فایل
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Print & Finishing Tab -->
                        <div class="tab-pane fade" id="print" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="fusing_type" name="fusing_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="چسب دوطرفه">چسب دوطرفه</option>
                                            <option value="چسب حرارتی ">چسب حرارتی</option>
                                            <option value="لائی">لائی</option>
                                        </select>
                                        <label for="fusing_type">نوع چاپ</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="lamination_type" name="lamination_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="براق">براق</option>
                                            <option value="قالب جدید">قالب جدید</option>
                                            <option value="قالب تکراری">قالب تکراری</option>
                                            <option value="برجسته و براق">برجسته و براق</option>
                                            <option value="مات">مات</option>
                                        </select>
                                        <label for="lamination_type">نوع پرس</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="cut_type" name="cut_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="برش لیزر">برش لیزر</option>
                                            <option value="برش بغل">برش بغل</option>
                                            <option value="برش دانه ای">برش دانه‌ای</option>
                                            <option value="برش یک طرف زیاد">برش یک طرف زیاد</option>
                                            <option value="تا از وسط">تا از وسط</option>
                                        </select>
                                        <label for="cut_type">نوع برش</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="label_type" name="label_type">
                                            <option value="">انتخاب کنید...</option>
                                            <option value="خشک">خشک</option>
                                            <option value="نرم">نرم</option>
                                            <option value="متوسط">متوسط</option>
                                        </select>
                                        <label for="label_type">نوع آهار</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dates & Status Tab -->
                        <div class="tab-pane fade" id="dates" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="delivery_date" name="delivery_date">
                                        <label for="delivery_date">تاریخ تحویل</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="exit_from_office_date" name="exit_from_office_date">
                                        <label for="exit_from_office_date">تاریخ خروج از دفتر</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <input type="date" class="form-control" id="exit_from_factory_date" name="exit_from_factory_date">
                                        <label for="exit_from_factory_date">تاریخ خروج از کارخانه</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <select class="form-select" id="status" name="status">
                                            <option value="Pending">در انتظار</option>
                                            <option value="In Progress">در حال انجام</option>
                                            <option value="Completed">تکمیل شده</option>
                                        </select>
                                        <label for="status">وضعیت</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notes Tab -->
                        <div class="tab-pane fade" id="notes" role="tabpanel">
                            <div class="row g-4">
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="design_specification" name="design_specification" style="height: 100px"></textarea>
                                        <label for="design_specification">مشخصات طراحی</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="office_notes" name="office_notes" style="height: 100px"></textarea>
                                        <label for="office_notes">یادداشت‌های دفتر</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="factory_notes" name="factory_notes" style="height: 100px"></textarea>
                                        <label for="factory_notes">یادداشت‌های کارخانه</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="customer_note_to_office" name="customer_note_to_office" style="height: 100px"></textarea>
                                        <label for="customer_note_to_office">یادداشت مشتری به دفتر</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Images Tab -->
                        <div class="tab-pane fade" id="images" role="tabpanel">
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <div class="card">
                                        <div class="card-body">
                                            <h6 class="card-title mb-3">بارگذاری تصاویر</h6>
                                            <div class="mb-3">
                                                <label for="orderImages" class="form-label">انتخاب تصاویر</label>
                                                <input type="file" class="form-control" id="orderImages" name="images" multiple accept="image/*">
                                                <div class="form-text">حداکثر حجم فایل: ۱۰ مگابایت. فرمت‌های مجاز: PNG, JPG, JPEG, GIF, WEBP</div>
                                            </div>
                                            <div id="imagePreviewContainer" class="row g-2 mt-3">
                                                <!-- Image previews will be added here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light">
                    <div class="d-flex justify-content-between w-100">
                        <div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i>انصراف
                            </button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-outline-primary me-2" id="prevTab">
                                <i class="fas fa-arrow-right me-2"></i>قبلی
                            </button>
                            <button type="button" class="btn btn-outline-primary me-2" id="nextTab">
                                بعدی<i class="fas fa-arrow-left ms-2"></i>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>ایجاد سفارش
                            </button>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- End of Create Order Modal -->

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add file row functionality for create order modal
    const addFileRowBtn = document.getElementById('addFileRowBtn');
    if (addFileRowBtn) {
        addFileRowBtn.addEventListener('click', function() {
            const tbody = document.getElementById('filesTableBody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td><input type="text" class="form-control form-control-sm" name="file_display_names[]"></td>
                <td><input type="text" class="form-control form-control-sm" name="order_files[]"></td>
            `;
            tbody.appendChild(newRow);
        });
    }

    // Tab navigation functionality
    const nextTabBtn = document.getElementById('nextTab');
    const prevTabBtn = document.getElementById('prevTab');
    const tabButtons = document.querySelectorAll('#orderFormTabs .nav-link');
    const tabPanes = document.querySelectorAll('.tab-pane');
    const progressBar = document.getElementById('formProgress');

    let currentTabIndex = 0;

    // Function to update progress bar
    function updateProgress() {
        const progress = ((currentTabIndex + 1) / tabButtons.length) * 100;
        progressBar.style.width = progress + '%';
    }

    // Function to show specific tab
    function showTab(index) {
        // Hide all tabs
        tabPanes.forEach(pane => {
            pane.classList.remove('show', 'active');
        });
        tabButtons.forEach(btn => {
            btn.classList.remove('active');
        });

        // Show specific tab
        if (index >= 0 && index < tabButtons.length) {
            tabPanes[index].classList.add('show', 'active');
            tabButtons[index].classList.add('active');
            currentTabIndex = index;
            updateProgress();
        }

        // Update button states
        prevTabBtn.disabled = currentTabIndex === 0;
        nextTabBtn.disabled = currentTabIndex === tabButtons.length - 1;
    }

    // Next button click handler
    if (nextTabBtn) {
        nextTabBtn.addEventListener('click', function() {
            if (currentTabIndex < tabButtons.length - 1) {
                showTab(currentTabIndex + 1);
            }
        });
    }

    // Previous button click handler
    if (prevTabBtn) {
        prevTabBtn.addEventListener('click', function() {
            if (currentTabIndex > 0) {
                showTab(currentTabIndex - 1);
            }
        });
    }

    // Tab button click handlers
    tabButtons.forEach((button, index) => {
        button.addEventListener('click', function() {
            showTab(index);
        });
    });

    // Initialize progress bar
    updateProgress();
});
</script>
